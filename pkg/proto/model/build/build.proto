syntax = "proto3";

package buildbarn.playground.model.build;

import "pkg/proto/model/core/core.proto";
import "pkg/proto/model/filesystem/filesystem.proto";

option go_package = "github.com/buildbarn/bb-playground/pkg/proto/model/build";

message Module {
  // The name of the module for which source code is provided, without
  // the leading "@" (e.g., "rules_go").
  string name = 1;

  // Reference to a Directory message that describes the root directory
  // of this module. The root directory MUST contain a file named
  // "MODULE.bazel".
  buildbarn.playground.model.core.Reference root_directory_reference = 2;
}

message BuildSpecification {
  // Non-empty list of modules for which explicit copies of source code
  // are provided.
  repeated Module modules = 1;

  // The name of the module whose MODULE.bazel file should be treated as
  // the root for the sake of resolving dependencies. Any calls to
  // archive_override(), git_override(), multiple_version_override(), or
  // single_version_override() in MODULE.bazel files other than the one
  // belonging to the root module are ignored.
  string root_module_name = 2;

  // Patterns of targets that should be built.
  //
  // TODO: Must target names be provided in canonical form?
  repeated string target_patterns = 3;

  // Parameters that the client used to create objects containing
  // Directory and Leaves messages. The server MUST also use these
  // parameters when creating output directories.
  buildbarn.playground.model.filesystem.DirectoryCreationParameters
      directory_creation_parameters = 4;

  // Parameters that the client used to create objects containing
  // FileContentsList messages and file chunks. The server MUST also use
  // these parameters when creating output files.
  buildbarn.playground.model.filesystem.FileCreationParameters
      file_creation_parameters = 5;
}
